# 批量图像生成功能使用指南

## 功能概述

新增的 `batch_generate_images` 工具允许您一次性生成多张图像，支持并行处理和灵活的批次管理，大幅提升工作效率。

## 工具参数

### 必需参数
- **prompts** (array): 提示词数组，最多支持100个提示词

### 可选参数

#### 基础参数
- **model** (string): 使用的模型，可选值：
  - `cogview-4` (最新模型)
  - `cogview-4-250304` (特定版本)
  - `cogview-3-flash` (默认，免费快速)

- **quality** (string): 图像质量，可选值：
  - `standard` (默认)
  - `hd`

- **size** (string): 图像尺寸，例如：
  - `1024x1024` (默认)
  - `1024x1792` (竖版)
  - `1792x1024` (横版)

- **watermark_enabled** (boolean): 是否添加水印，默认 `true`

- **user_id** (string): 用户ID，6-128个字符，用于跟踪使用情况

#### 批次管理参数
- **batch_size** (number): 每批处理的提示词数量，默认4，范围1-20
- **parallel** (boolean): 是否并行处理批次内的请求，默认 `true`
- **max_concurrent** (number): 并行处理时的最大并发数，默认3，范围1-10
- **delay_between_batches** (number): 批次间的延迟时间（毫秒），默认1000，范围0-10000

## 使用示例

### 基础用法
```json
{
  "prompts": [
    "一只可爱的小猫在花园里玩耍",
    "现代城市的夜景，灯火辉煌",
    "一个程序员在电脑前工作"
  ],
  "model": "cogview-3-flash",
  "quality": "standard",
  "size": "1024x1024"
}
```

### 高级用法
```json
{
  "prompts": [
    "春天的樱花盛开，粉色花瓣飘落",
    "夏日海滩的日落，橙红色的天空",
    "秋天的枫叶林，金黄色的叶子",
    "冬天的雪山，阳光照在雪地上",
    "现代科技公司的办公室",
    "古典图书馆的内部",
    "繁忙的咖啡厅",
    "宁静的禅意花园"
  ],
  "model": "cogview-4",
  "quality": "hd",
  "size": "1024x1024",
  "batch_size": 4,
  "parallel": true,
  "max_concurrent": 2,
  "delay_between_batches": 2000,
  "watermark_enabled": false,
  "user_id": "my_project_123"
}
```

### 快速批量（并行模式）
```json
{
  "prompts": [
    "抽象艺术作品",
    "未来城市的概念图",
    "科幻场景",
    "奇幻森林"
  ],
  "parallel": true,
  "max_concurrent": 4,
  "delay_between_batches": 0
}
```

### 稳定批量（串行模式）
```json
{
  "prompts": [
    "产品展示图1",
    "产品展示图2",
    "产品展示图3"
  ],
  "parallel": false,
  "batch_size": 1,
  "delay_between_batches": 3000
}
```

## 返回结果格式

### 统计信息
- 总提示词数
- 成功生成数
- 生成失败数
- 成功率
- 处理时间（总时间、平均每批次时间）

### 详细结果
- 每个提示词的处理结果
- 成功：生成的图像URL和修订后的提示词
- 失败：具体的错误信息

### 便捷功能
- 所有成功图像的URL列表（便于批量复制）
- 详细的处理时间统计

## 最佳实践

### 1. 性能优化
- 使用 `parallel: true` 提高处理速度
- 调整 `max_concurrent` 控制并发数（建议3-5）
- 设置适当的 `delay_between_batches` 避免API限制

### 2. 错误处理
- 检查返回结果中的失败项目
- 分析失败原因（提示词问题、API限制等）
- 重新尝试失败的提示词

### 3. 成本控制
- 优先使用 `cogview-3-flash` 模型（免费）
- 适当控制批次大小
- 监控使用统计

### 4. 提示词优化
- 确保提示词描述清晰具体
- 避免过长的提示词（建议不超过4000字符）
- 测试不同风格的提示词效果

## 限制说明

- 单次最多支持100个提示词
- 每批最多20个提示词
- 最大并发数为10
- 批次间延迟最多10秒

## 错误类型

- `INVALID_PARAMS`: 参数无效
- `TOO_MANY_PROMPTS`: 提示词数量过多
- API相关错误（网络、配额、内容过滤等）

## 测试方法

使用提供的测试脚本：
```bash
# 设置API密钥
export IMAGE_VIDEO_GENERATION_API_KEY="your_api_key"

# 运行测试
node test-batch.js
```

## 与现有工具的对比

| 功能 | 单个图像生成 | 批量图像生成 |
|------|-------------|-------------|
| 处理能力 | 1个提示词 | 1-100个提示词 |
| 并行处理 | 不支持 | 支持 |
| 批次管理 | 无 | 灵活配置 |
| 错误恢复 | 手动重试 | 自动统计失败项 |
| 效率 | 低 | 高 |

## 未来规划

- 支持图像变体批量生成
- 添加进度回调功能
- 集成云存储自动上传
- 支持更多文件格式导出